# 基于排序与条件判断的责任链模式

## 模式描述

整个流程由 `Processor` 作为调度处理器，通过依赖注入获取按 `@Order` 注解排序的多个 `HandlerImpl` 步骤处理器，在处理过程中每个步骤处理器先通过 `shouldHandle()` 方法判断是否参与当前业务场景，满足条件则执行 `handle()` 方法完成具体业务逻辑，上下文数据通过 `Context` 在处理器间传递。

## 组件定义

- `Context` 上下文
  - 定义整个业务处理流程中的上下文，负责在多个 `Handler` 之前传递上下文
- `Handler` 步骤处理器接口
  - 定义步骤处理器，默认有 `shouldHandle()`、`handle()` 两个方法
  - 编写多个 `Handler` 的实现类，在 `Processor` 中统一注入并被调用
- `HandlerImpl` 步骤处理器实现
  - 实现 `Handler` 接口
  - 使用 `@Order` 指定步骤处理器执行顺序，其值取自 `Processor` 中的步骤定义
  - 实现 `shouldHandle()` 方法，判断当前实现是否会被调用，即是否执行 `handle()` 方法
  - 实现 `handle()` 方法，当前步骤处理器的逻辑实现
- `Processor` 调度处理器
  - 负责步骤处理器的调度，统一注入 `HandlerImpl` 列表，执行调度
  - 定义 `HandlerImpl` 的执行顺序 `STEP`，如 `STEP_10`、`STEP_20`，在 `HandlerImpl` 中使用 `@Order` 注解指定步骤处理器执行顺序

## 其他偏好

- 完整注释：每个方法都要有完整的 JavaDoc 注释
- 注释语言：使用简体中文
- 方法命名：体现业务语义
- 方法职责：单一职责原则，方法长度不过长
- Lombok 使用：允许使用 `@Data`、`@RequiredArgsConstructor` 等减少样板代码
- 依赖注入：使用 `@RequiredArgsConstructor` 进行构造函数注入
- 步骤顺序注释：在 `Processor` 中定义 `STEP` 时，添加对应步骤的注释

## 示例代码

XxxContext

```java
@Data
public class XxxContext {
    // 根据业务需要定义上下文字段
    private XxxReq xxxReq;
    private Long xxxId;
}
```

XxxHandler

```java
public interface XxxHandler {
    /**
     * 是否应该处理
     *
     * @param context 上下文
     * @return 是否应该处理
     */
    boolean shouldHandle(XxxContext context);

    /**
     * 处理
     *
     * @param context 上下文
     */
    void handle(XxxContext context);
}
```

XxxHandlerImpl

```java
@Order(XxxProcessor.STEP_10)
@Service
@RequiredArgsConstructor
public class XxxHandlerImpl implements XxxHandler {
    private final XxxRepository xxxRepository;

    /**
     * 是否应该处理
     *
     * @param context 上下文
     * @return 是否应该处理
     */
    @Override
    public boolean shouldHandle(XxxContext context) {
        return true;
    }

    /**
     * 处理
     *
     * @param context 上下文
     */
    @Override
    public void handle(XxxContext context) {
        // 当前步骤的业务逻辑
    }
}
```

XxxProcessor

```java
@Service
@RequiredArgsConstructor
public class XxxProcessor {
    // 定义业务逻辑步骤顺序
    public static final int STEP_10 = 10;
    public static final int STEP_20 = 20;
    public static final int STEP_30 = 30;
    private final List<XxxHandler> handlers;

    /**
     * 调度步骤处理器
     *
     * @param context 上下文
     */
    public void process(XxxContext context) {
        for (XxxHandler handler : handlers) {
            if (handler.shouldHandle(context)) {
                handler.handle(context);
            }
        }
    }
}
```
